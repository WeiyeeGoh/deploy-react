(this.webpackJsonpchat_client=this.webpackJsonpchat_client||[]).push([[0],{31:function(e,t,n){},50:function(e,t,n){},55:function(e,t,n){"use strict";n.r(t);var s=n(1),c=n(0),o=n.n(c),a=n(9),r=n.n(a),i=(n(31),n(10)),l=n(6),u=n(15),d=n.n(u),j=(n(50),n(51),n(11)),b=n(25),g=n(12),O=function(e){var t=e.login,n=e.connected,o=Object(c.useState)({URL:"",username:"",password:""}),a=Object(l.a)(o,2),r=a[0],i=a[1],u=Object(c.useState)(!0),d=Object(l.a)(u,2),O=d[0],p=d[1];Object(c.useEffect)((function(){console.log("USE EFFECT"),n||i({URL:"",username:"",password:""}),p(!n)}),[n]);return Object(s.jsx)("div",{class:"overlay",children:Object(s.jsxs)(g.a,{show:O,children:[Object(s.jsx)(g.a.Header,{closeButton:!0,children:Object(s.jsx)(g.a.Title,{children:"Login"})}),Object(s.jsxs)(g.a.Body,{children:[Object(s.jsxs)("div",{className:"input-group input-group-sm mb-3",children:[Object(s.jsx)("div",{className:"input-group-prepend",children:Object(s.jsx)("span",{className:"input-group-text",id:"inputGroup-sizing-sm",children:"URL"})}),Object(s.jsx)("input",{type:"text",className:"form-control","aria-label":"Small","aria-describedby":"inputGroup-sizing-sm",onChange:function(e){return i(Object(j.a)(Object(j.a)({},r),{},{URL:e.target.value}))},value:r.URL})]}),Object(s.jsxs)("div",{className:"input-group input-group-sm mb-3",children:[Object(s.jsx)("div",{className:"input-group-prepend",children:Object(s.jsx)("span",{className:"input-group-text",id:"inputGroup-sizing-sm",children:"Username"})}),Object(s.jsx)("input",{type:"text",className:"form-control","aria-label":"Small","aria-describedby":"inputGroup-sizing-sm",onChange:function(e){return i(Object(j.a)(Object(j.a)({},r),{},{username:e.target.value}))},value:r.username})]}),Object(s.jsxs)("div",{className:"input-group input-group-sm mb-3",children:[Object(s.jsx)("div",{className:"input-group-prepend ",children:Object(s.jsx)("span",{className:"input-group-text",id:"inputGroup-sizing-sm",children:"Password"})}),Object(s.jsx)("input",{type:"text",className:"form-control","aria-label":"Small","aria-describedby":"inputGroup-sizing-sm",onChange:function(e){return i(Object(j.a)(Object(j.a)({},r),{},{password:e.target.value}))},value:r.password})]})]}),Object(s.jsx)(g.a.Footer,{children:Object(s.jsx)(b.a,{variant:"secondary",onClick:function(){t(r)},children:"Login"})})]})})},p=function(e){var t=e.loginData,n=e.token,o=Object(c.useState)(""),a=Object(l.a)(o,2),r=a[0],i=a[1],u=Object(c.useState)(null),j=Object(l.a)(u,2),b=j[0],g=j[1];Object(c.useEffect)((function(){g(t)}),[t]);return Object(s.jsx)("div",{id:"compose",children:Object(s.jsx)("input",{type:"text",className:"form-control","aria-label":"Small","aria-describedby":"inputGroup-sizing-sm",onKeyDown:function(e){if("Enter"===e.key&&""!=r&&null!=t){var s=new FormData;s.append("message",r);var c={method:"post",baseURL:t.URL,url:"/message",data:s,headers:{Authorization:"Bearer "+n}};d()(c),i("")}},onChange:function(e){return i(e.target.value)},value:null==b?"You need to be logged into send a message":r})})},f=function(e){var t=e.messageList,n=Object(c.useState)([]),o=Object(l.a)(n,2),a=o[0],r=o[1],i=Object(c.useRef)(null);Object(c.useEffect)((function(){i&&i.current.addEventListener("DOMNodeInserted",(function(e){var t=e.currentTarget;t.scroll({top:t.scrollHeight,behavior:"smooth"})}))})),Object(c.useEffect)((function(){console.log("USE EFFECT"),r(t)}),[t]);return Object(s.jsx)("div",{id:"message_box",ref:i,children:function(){console.log("BUILD");var e=a.map((function(e){var t=e[0],n=e[1],c=new Date(1e3*n.created);return"message"==t?Object(s.jsxs)("li",{children:[c.toLocaleString("en-US")," (",n.user,") ",n.message]}):"join"==t||"part"==t?Object(s.jsxs)("li",{children:[c.toLocaleString("en-US")," ",t.toUpperCase(),": ",n.user]}):"serverstatus"==t?Object(s.jsxs)("li",{children:[c.toLocaleString("en-US")," STATUS: ",n.status]}):void 0}));return Object(s.jsx)("ul",{children:e})}()})},S=function(e){var t=e.currentUsers,n=Object(c.useState)(t),o=Object(l.a)(n,2),a=o[0],r=o[1];Object(c.useEffect)((function(){console.log("USE EFFECT"),console.log(JSON.parse(JSON.stringify(t))),r(t)}),[t]);return Object(s.jsx)("div",{id:"userlist",children:function(){console.log("BUILD"),console.log(JSON.parse(JSON.stringify(a)));var e=a.map((function(e){return Object(s.jsx)("li",{children:e})}));return Object(s.jsxs)("ul",{children:[Object(s.jsx)("li",{children:Object(s.jsx)("u",{children:Object(s.jsx)("b",{children:Object(s.jsx)("i",{children:"USER LIST"})})})}),e]})}()})},m=function(){var e=Object(c.useState)(null),t=Object(l.a)(e,2),n=t[0],o=t[1],a=Object(c.useState)(null),r=Object(l.a)(a,2),u=r[0],j=r[1],b=Object(c.useState)([]),g=Object(l.a)(b,2),m=g[0],h=g[1],v=Object(c.useState)([]),x=Object(l.a)(v,2),E=x[0],L=x[1],N=Object(c.useState)(!1),U=Object(l.a)(N,2),y=U[0],R=U[1];return Object(c.useEffect)((function(){if(n){var e=new FormData;e.append("username",n.username),e.append("password",n.password);var t={method:"post",baseURL:n.URL,url:"/login",data:e};d()(t).then((function(e){return e.data.token})).then((function(e){console.log("Set Tokem to "+e),j(e);var t=new EventSource(n.URL+"/stream/"+e);t.onmessage=function(t){console.log("Toke "+e),console.log("EVENT: "+t.type),console.log("ID: "+t.lastEventId),console.log(t.data)},t.addEventListener("Disconnect",(function(e){console.log("DISCONNECT"),t.close(),R(!1),o(null)})),t.addEventListener("Join",(function(e){console.log("WHY CHANGE??"),console.log(JSON.parse(JSON.stringify(m))),console.log("JOIN");try{console.log(e.data);var t=JSON.parse(e.data);"user"in t&&"created"in t&&(h((function(e){return[].concat(Object(i.a)(e),[t.user])})),L((function(e){return[Object(i.a)(e).filter((function(e){return e!==t.user})),["join",t]]})))}catch(e){console.log("JOIN: data is not legit"),console.log(e)}})),t.addEventListener("Message",(function(e){console.log("MESSAGE");try{var t=JSON.parse(e.data);console.log("MESSAGES :SLDKFJ SDF:LKSJD F:SDLFKJ DSF:KLJ "),console.log(e.data),"user"in t&&"message"in t&&"created"in t&&L((function(e){return[].concat(Object(i.a)(e),[["message",t]])}))}catch(e){console.log("MESSAGES: data is not legit"),console.log(e)}})),t.addEventListener("Part",(function(e){console.log("PART");try{console.log(e.data);var t=JSON.parse(e.data);"user"in t&&"created"in t&&(h((function(e){return Object(i.a)(e).filter((function(e){return e!==t.user}))})),L((function(e){return[].concat(Object(i.a)(e),[["part",t]])})))}catch(e){console.log("PART: data is not legit"),console.log(e)}})),t.addEventListener("ServerStatus",(function(e){console.log("SERVERSTATUS");try{console.log(e.data);var t=JSON.parse(e.data);"status"in t&&"created"in t&&L((function(e){return[].concat(Object(i.a)(e),[["serverstatus",t]])}))}catch(e){console.log("SERVERSTATUS: data is not legit"),console.log(e)}})),t.addEventListener("Users",(function(e){console.log("USERS");try{console.log(e.data);var t=JSON.parse(e.data);"users"in t&&h(t.users),R(!0)}catch(e){console.log("USERS: data is not legit"),console.log(e)}})),t.addEventListener("error",(function(e){console.log("ERROR");try{o(null),R(!1)}catch(e){console.log("ERROR: data is not legit"),console.log(e)}}))}))}}),[n]),Object(s.jsxs)("div",{className:"container",children:[Object(s.jsx)(O,{login:function(e){return o(e)},connected:y,style:null==o?"display:none":""}),Object(s.jsx)("div",{id:"title",class:y?"green_title":"red_title",children:Object(s.jsx)("span",{children:"CS291"})}),Object(s.jsx)(f,{messageList:E}),Object(s.jsx)(S,{currentUsers:m}),Object(s.jsx)(p,{loginData:n,token:u})]})};r.a.render(Object(s.jsx)(o.a.StrictMode,{children:Object(s.jsx)(m,{})}),document.getElementById("root"))}},[[55,1,2]]]);
//# sourceMappingURL=main.d8987dc5.chunk.js.map